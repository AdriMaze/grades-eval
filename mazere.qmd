---
title: "Final graded lab Adriel Mazère"
author: "Adriel Mazère"
format:
  html:
    code-fold: true
---

From [here](https://github.com/AdriMaze/grades-eval.git) you can access to the Github.

```{r}
#| message: false
here::i_am("grades-eval-adriel-mazere.Rproj")
library(here)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(knitr)
library(lubridate)
```

# Introduction

You are an independent contractor and you have been selected by the Dean of The Spirit Academy of the Savanna to analyse the performances of their students. For confidentiality issues, you had to travel to a mystical forest in the heart of Africa to get access to the data. But strangely, you are requested to use github to store your work. The ways of The Spirit Academy of the Savanna are mysterious…

## Study organisation
At The Spirit Academy of the Savanna each student follows 10 different courses that are organised in 2 semesters. Students are divided into 15 groups.
The number of grades per course depends on the course but also on the student as they may fail to attend to an exam. The names of the courses, their assignment to semesters and their number of exams are given in the `courses.csv` file which as the following columns:

• `course`: the name of the course

• `course_id`: a unique key to identify the course

• `semester`: the semester of the course

• `nb_exams`: the number of exams in the course

**Question 1**

Load the course description file.

```{r}
#| message: false
courses <- here("data", "courses.csv") |>
  read_csv() |>
  mutate(
    course = as.character(course),
    course_id = as.integer(course_id),
    nb_grades = as.integer(nb_grades),
    semester = as.integer(semester)
  )
```
**Question 2**

Display the content of the file in a nicely formatted table in your document. Courses should be sorted in alphabetical order and column names should be written in English. This has to be done in R for instance using `knitr::kable()`.

```{r}
#| message: false
courses |>
  arrange(course) |>
  kable()
```
## Students
Students are described in the `students.csv` CSV file. 

Students are uniquely identified by the `id` column. Their group is given by the `group` column which contains the unique identifier of the group. The `birth_date` column contains the birth date of the students. The `sex` gives the sex of each student (F or M). It is also highly recommend to have group loaded as a factor and id as an integer.

**Question 3**

Load the student data set. Make sure the birth dates are correctly identified as Date objects by including the class of the corresponding column in the rendered text. For instance, include a sentence of the following form:

The birth_date column of the students data frame is of class Date.
Make also sure that the sex is identified as a factor.

```{r}
#| message: false
students <- here("data","students.csv") |>
  read_csv() |>
  mutate(
    group = as.factor(group),
    id = as.integer(id),
    birth_date = as.Date(birth_date),
    sex = as.factor(sex)
  )
paste("The", "birth_date", "column of the students data frame is of class", 
  class(students$birth_date))
```

## Grades
The grades are stored in the `grades.csv` CSV file. The first five rows of this data set are given in the following table:

The data set uses a long format with a small number of columns and a large number of rows. Each row gives the `grade` of a student for a course. Grades are between 0 (the worst) and 20 (the best). Students are identified by the `id` column which contains their unique identifier, while the course is identified by the `course_id` column which contains the unique identifier of the course.

Unfortunately, The Spirit Academy of the Savanna does not maintain very high data management standards and the `grades.csv` file is not perfectly encoded:

• rather than using a comma as the separator, the file uses the following character: :.

• rather than using `NA` to represent missing data, the file uses this: $.

**Question 4** 
Load the grade data set despite the encoding issues.

```{r}
#| message: false
grades <- here("data", "grades.csv") |>
  read_delim(
    delim = ":",
    na = "$"
  ) |>
  mutate(
    id = as.integer(id),
    course_id = as.integer(course_id),
    grade = as.integer(grade)
  )
```

# Student population analysis

**Question 5**

Use a graphical representation to display the number of students per group.

```{r}
#| message: false
students |>
  count(group) |>
  ggplot(aes(x = group, y = n)) +
  geom_col(fill = "steelblue") +
  labs(title = "Number of students per group",
       x = "Group", y = "Number of students") +
  theme_minimal()
```
**Question 6**

Show the gender balance in each group on a single graphical representation.

```{r}
#| message: false
students |>
  count(group, sex) |>
  ggplot(aes(x = group, y = n, fill = sex)) +
  geom_col(position = "fill") +
  scale_fill_manual(values = c("lightblue", "salmon")) +
  labs(title = "Gender balance by group",
    x = "Group", y = "Count", fill = "Gender") +
  theme_minimal()
```

**Question 7**

Show graphically the distribution of the age of the students.

```{r}
#| message: false
students <- students |>
  mutate(age = time_length(today() - birth_date, unit = "year"))
students |> ggplot(aes(x = age)) +
  geom_histogram(fill = "steelblue", color = "white", bins = 20) +
  labs(title = "Distribution of student ages",
    x = "Age", y = "Count") +
  theme_minimal()
```
**Question 8**

Compute the median age of the students in each group and include in your rendering a table giving the median age for each group. The median should be reported as an integer.

```{r}
#| message: false
students |>
  group_by(group) |>
  summarise(median_age = round(median(age))) |>
  select(group, median_age) |>
  kable()
```
**Question 9**

Build a table with the id, sex and age of the oldest student in each group. Sort the table by decreasing age order and include it in the rendering.

```{r}
#| message: false
students |>
  mutate(age = round(age)) |>
  group_by(group) |>
  filter(age == max(age)) |>
  ungroup() |>
  arrange(desc(age)) |>
  select(id, sex, age) |>
  kable()
```
# Simple grade analysis

**Question 10**

Give the number of grades in the data set directly in the text of your quarto file, in a sentence of the form “The data set contains xxx grades.” where xxx is replaced by the number of grades.
This must be computed from the data set. Note that missing grades should obviously not be included in the total.

```{r}
#| message: false
paste0(
  "The data set contains ", grades |>
    filter(!is.na(grade)) |>
    nrow(),
  " grades.")
```

**Question 11**
Compute the average of all the grades in *Herbalism and Traditional Medicine* in each group and display graphically this average as a function of the group. It is recommend to use `geom_col()` for this task (read the documentation!).

```{r}
#| message: false
grades |>
  inner_join(courses,  by = "course_id") |>
  inner_join(students, by = "id") |>
  filter(course == "Herbalism and Traditional Medicine") |>
  filter(!is.na(grade)) |>
  group_by(group) |>
  summarise(avg_grade = mean(grade)) |>
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Average grade in Herbalism and Traditional Medicine",
    x = "Group", y = "Average grade") +
  theme_minimal()
```

**Question 12**

Compare graphically the distribution of the grades of the 2 semesters.

```{r}
#| message: false
grades |>
  inner_join(courses, by = "course_id") |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = grade, fill = factor(semester))) +
  geom_density(alpha = 0.7) +
  scale_fill_manual(values = c("steelblue", "salmon")) +
  labs(
    title = "Distribution of grades by semester",
    x = "Grade",
    y = "Density",
    fill = "Semester") +
  theme_minimal()
```
# Attendance analysis

**Question 13** 

Compute the number of grades per student and include in your quarto rendering an extract of the resulting data frame. Make sure to keep in the data frame the id of the students but also their group and their sex. Include in the text a markdown table with the minimum, maximum, average and median number of grades per student.

```{r}
#| message: false
grades |>
  filter(!is.na(grade)) |>
  count(id, name = "n_grades") |>
  inner_join(students, by = "id") |>
  select(id, group, sex, n_grades) |>
  slice_sample(n=10) |>
  kable()

grades |>
  filter(!is.na(grade)) |>
  count(id, name = "n_grades") |>
  summarise(
    min    = min(n_grades),
    max    = max(n_grades),
    mean   = round(mean(n_grades),1),
    median = median(n_grades)
  ) |>
  kable()
```
**Question 14**

Compare graphically the distribution of the number of grades for female and male students.

```{r}
#| message: false
grades |>
  filter(!is.na(grade)) |>
  count(id, name = "n_grades") |>
  inner_join(students, by = "id") |>
  ggplot(aes(x = n_grades, fill = sex)) +
  geom_density(alpha = 0.5) +
  scale_fill_manual(values = c("steelblue", "salmon")) +
  labs(title = "Distribution of number of grades by gender",
    x = "Number of grades", y = "Density") +
  theme_minimal()
```

**Question 15**

Create a data frame that gives for each student their id, their group and the number of grades they obtained in *Storytelling and Oral Tradition* and include in the quarto rendering a small extract of the result.

```{r}
#| message: false
storytelling <- grades |>
  inner_join(courses,  by = "course_id") |>
  inner_join(students, by = "id") |>
  filter(course == "Storytelling and Oral Tradition") |>
  filter(!is.na(grade)) |>
  group_by(id, group, sex) |>
  summarise(n_grades = n()) |>
  ungroup()
storytelling |>
  slice_sample(n = 10) |>
  kable()
```
**Question 16**

Compute from the previous data frame the distribution of the number of grades, that is for each number of grades (e.g. 10) the number of students who have exactly this number of grades in *Storytelling and Oral Tradition*. Represent graphically the results.

```{r}
storytelling |>
  count(n_grades) |>
  ggplot(aes(x = n_grades, y = n)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Distribution of number of Storytelling & Oral Tradition grades",
    x = "Number of grades",
    y = "Number of students") +
  theme_minimal()
```



